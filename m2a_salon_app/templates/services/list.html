{% extends 'base.html' %}
{% load custom_tags %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/services.css' %}">
{% endblock %}

{% block title %}Serviços — m2a Salon{% endblock %}

{% block content %}
<header class="d-flex justify-content-between px-2 py-4">
    <h2 class="mb-4">Serviços</h2>
    <button type="button" class="btn btn-primary mb-4" data-bs-toggle="modal" data-bs-target="#serviceModal">
        <i class="bi bi-plus-circle"></i> Novo serviço
    </button>
</header>

{% include "components/modal_form.html" with modal_id="serviceModal" modal_title="Novo Serviço" form=service_form action_url=service_create_url %}

{% if services %}
<div class="list-group">
    {% for service in services %}
    <div class="list-group-item d-flex justify-content-between align-items-center">
        <div>
            <h5 class="mb-1">{{ service.name }}</h5>
            <p class="mb-1 text-muted">
                Duração: {{ service.duration_minutes }} minutos —
                Preço: R$ {{ service.price|floatformat:2 }}
            </p>
        </div>

        <div class="btn-group gap-2" role="group" aria-label="Ações do serviço">
            <button class="btn btn-outline-secondary btn-sm d-flex align-items-center gap-1"
                    data-bs-toggle="modal" data-bs-target="#edit-service-modal{{ service.pk }}">
                <i class="bi bi-pencil"></i> Editar
            </button>

            <button class="btn btn-outline-danger btn-sm d-flex align-items-center gap-1"
                    data-bs-toggle="modal" data-bs-target="#delete-service-modal{{ service.pk }}">
                <i class="bi bi-trash"></i> Excluir
            </button>
        </div>
    </div>

    {% with service_data=edit_forms|get_item:service.pk %}
    {% include "components/modal_form.html" with modal_id=service_data.modal_id modal_title="Editar Serviço" form=service_data.form action_url=service_data.action_update_url %}
    {% endwith %}

    {% with delete_data=delete_modal|get_item:service.pk %}
    {% include "components/modal_confirm_delete.html" with modal_id=delete_data.modal_id modal_title="Excluir Serviço" action_url=delete_data.action_delete_url object_name=delete_data.object_name %}
    {% endwith %}

    {% endfor %}
</div>

{% if is_paginated %}
<nav class="mt-4">
    <ul class="pagination">
        {% if page_obj.has_previous %}
        <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.previous_page_number }}">&laquo;</a>
        </li>
        {% endif %}
        <li class="page-item disabled">
            <span class="page-link">Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>
        </li>
        {% if page_obj.has_next %}
        <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.next_page_number }}">&raquo;</a>
        </li>
        {% endif %}
    </ul>
</nav>
{% endif %}
{% else %}
<p class="text-muted">Nenhum serviço cadastrado.</p>
{% endif %}
{% endblock %}
